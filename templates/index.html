{% extends "base.html" %}
{% block content %}
<section class="mt-10">
  <h1 class="text-3xl md:text-4xl font-bold leading-tight">
    Check if a URL is <span class="text-emerald-400">Safe</span> or <span class="text-rose-400">Phishing</span>
  </h1>
  <p class="mt-2 text-slate-300">Our analyzer inspects 30+ signals, SSL, geolocation, redirects and more.</p>

  <!-- Form -->
  <form method="POST" action="/result" class="mt-6 flex flex-col md:flex-row gap-3">
    <input name="url" type="url" required placeholder="https://example.com/login"
      class="flex-1 rounded-2xl bg-white/10 backdrop-blur px-4 py-3 outline-none ring-1 ring-white/10 focus:ring-emerald-400 placeholder-slate-400">
    <button
      class="rounded-2xl px-6 py-3 bg-emerald-500 hover:bg-emerald-400 text-black font-semibold shadow-lg shadow-emerald-500/20 transition">
      Scan URL
    </button>
  </form>

  <!-- Error -->
  {% if error %}
    <div class="mt-6 rounded-xl border border-rose-400/30 bg-rose-900/20 p-4 text-rose-200">
      {{ error }}
    </div>
  {% endif %}

  <!-- Results -->
  {% if data %}
  <div class="mt-10 grid grid-cols-1 md:grid-cols-3 gap-6">
    <!-- Main card -->
    <div class="col-span-1 md:col-span-2 rounded-2xl border border-white/10 bg-white/5 p-6">
      <div class="flex items-center justify-between">
        <h2 class="text-xl font-semibold">Result</h2>
        <span class="text-xs text-slate-400">Risk Score</span>
      </div>

      <div class="mt-2 flex items-start justify-between gap-6">
        <div>
          <div class="text-slate-300 text-sm break-all">{{ data.url }}</div>
          <div class="mt-2 flex items-center gap-2">
            {% if data.status == "Safe" %}
              <span
                class="inline-flex items-center gap-2 rounded-full bg-emerald-500/20 px-3 py-1 text-emerald-300 ring-1 ring-emerald-400/30">● Safe</span>
            {% else %}
              <span
                class="inline-flex items-center gap-2 rounded-full bg-rose-500/20 px-3 py-1 text-rose-300 ring-1 ring-rose-400/30">● Phishing</span>
            {% endif %}
            <span class="text-slate-400">{{ data.headline }}</span>
          </div>

          <div class="mt-3 text-slate-300 text-sm">
            <strong>SSL:</strong> {{ data.ssl_info }}<br>
            <strong>Domain age:</strong> {% if data.domain_age_months >= 0 %}{{ data.domain_age_months }} months{% else %}Unknown{% endif %}<br>
            <strong>Server location:</strong> {{ data.location }}
          </div>
        </div>

        <div class="text-right">
          <div class="text-4xl font-bold">{{ data.risk_score }}<span class="text-base font-medium">%</span></div>
          <div class="h-2 mt-2 rounded bg-white/10">
            <div class="h-2 rounded {% if data.risk_score < 30 %}bg-emerald-400{% elif data.risk_score < 70 %}bg-amber-400{% else %}bg-rose-500{% endif %}"
              style="width: {{ data.risk_score }}%"></div>
          </div>
        </div>
      </div>

      {% if data.reasons %}
      <div class="mt-6">
        <h3 class="text-lg font-semibold">Why this decision?</h3>
        <ul class="mt-2 grid grid-cols-1 md:grid-cols-2 gap-2">
          {% for r in data.reasons %}
          <li class="rounded-lg bg-white/5 border border-white/10 px-3 py-2 text-sm">• {{ r }}</li>
          {% endfor %}
        </ul>
      </div>
      {% endif %}

      {% if data.redirects and data.redirects|length > 0 %}
      <div class="mt-6">
        <h3 class="text-lg font-semibold">Redirect chain</h3>
        <div class="mt-2 text-sm text-slate-300 break-words">
          {% for u in data.redirects %}
            <div class="truncate">↳ {{ u }}</div>
          {% endfor %}
        </div>
      </div>
      {% endif %}
    </div>

    <!-- Side card -->
    <div class="col-span-1 rounded-2xl border border-white/10 bg-white/5 p-6">
      <h3 class="text-lg font-semibold">Actions</h3>
      <div class="mt-3 flex flex-col gap-2">
        <a href="https://safebrowsing.google.com/safebrowsing/report_phish/?hl=en" target="_blank" rel="noreferrer"
          class="rounded-xl bg-rose-500/20 ring-1 ring-rose-400/30 px-4 py-2 hover:bg-rose-500/30">Report to Google Safe
          Browsing</a>
        <button id="copy-json" data-json='{{ data | tojson }}'
          class="rounded-xl bg-white/10 ring-1 ring-white/20 px-4 py-2 hover:bg-white/20 text-left">Copy JSON</button>
      </div>

      <details class="mt-6">
        <summary class="cursor-pointer text-slate-200">Feature vector (30)</summary>
        <ul class="mt-2 space-y-1 text-sm text-slate-300">
          {% for name, val in data.features %}
          <li class="flex items-center justify-between">
            <span>{{ loop.index }}. {{ name }}</span>
            <span
              class="font-mono {% if val == 1 %}text-emerald-400{% elif val == 0 %}text-amber-300{% else %}text-rose-400{% endif %}">{{ val }}</span>
          </li>
          {% endfor %}
        </ul>
      </details>
    </div>
  </div>
  {% endif %}
</section>
{% endblock %}
